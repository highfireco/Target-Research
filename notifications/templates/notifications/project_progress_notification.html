{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ความคืบหน้าโครงการ</title>

    <link rel="stylesheet" href="{% static 'notifications/css/progress.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

<div class="container">
    <div class="header-section">
        <button class="back-button" onclick="goBack()">
            <i data-lucide="arrow-left"></i>
            กลับ
        </button>

        <div class="icon-wrapper">
            <i data-lucide="trending-up"></i>
        </div>

        <h1>ความคืบหน้าโครงการ</h1>
        <div class="subtitle">ติดตามความคืบหน้าโครงการทั้งหมดของคุณ</div>
    </div>

    <!-- Filter -->
    <div class="categories">
        <button class="category-btn active" data-filter="all">
            ทั้งหมด ({{ projects|length }})
        </button>
        <button class="category-btn" data-filter="in-progress">
            กำลังดำเนินการ
        </button>
        <button class="category-btn" data-filter="completed">
            เสร็จสิ้น
        </button>
    </div>

    <!-- Dynamic Projects -->
    {% for project in projects %}
    <div class="project-card" data-status="{{ project.status }}">
        <div class="project-header">
            <div class="project-info">
                <h2 class="project-title">{{ project.survey_title }}</h2>
                <p class="project-desc">{{ project.survey_description }}</p>

                <div class="project-meta">
                    <div class="meta-item">
                        <i data-lucide="calendar"></i>
                        <span>เริ่ม: {{ project.start_date|date:"d M Y" }}</span>
                    </div>

                    <div class="meta-item">
                        <i data-lucide="flag"></i>
                        <span>สิ้นสุด: {{ project.end_date|date:"d M Y" }}</span>
                    </div>

                    <div class="meta-item">
                        <i data-lucide="users"></i>
                        <span>{{ project.num_responds }}/{{ project.sample_size }} คน</span>
                    </div>
                </div>
            </div>

            {% if project.status == "completed" %}
                <span class="status-badge status-completed">เสร็จสิ้น</span>
            {% else %}
                <span class="status-badge status-in-progress">กำลังดำเนินการ</span>
            {% endif %}
        </div>

        <div class="progress-section">
            <div class="progress-header">
                <span class="progress-label">ความคืบหน้า</span>
                <span class="progress-percentage">
                    {{ project.progress_percentage }}%
                </span>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar"
                     style="width: {{ project.progress_percentage }}%">
                </div>
            </div>
        </div>
    </div>
    {% empty %}
        <p style="text-align:center; margin-top:40px;">
            ยังไม่มีโครงการ
        </p>
    {% endfor %}
</div>

<script>
    lucide.createIcons();

    function goBack() {
        window.location.href = "{% url 'notification_home' %}";
    }

    // FILTER
    const buttons = document.querySelectorAll('.category-btn');
    const cards = document.querySelectorAll('.project-card');

    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            buttons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const filter = btn.dataset.filter;

            cards.forEach(card => {
                const status = card.dataset.status;

                if (filter === 'all') {
                    card.style.display = 'block';
                } else if (filter === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });

    // Animate progress bars
    window.addEventListener('load', () => {
        const progressBars = document.querySelectorAll('.progress-bar');
        progressBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 100);
        });
    });
</script>

</body>
</html>
