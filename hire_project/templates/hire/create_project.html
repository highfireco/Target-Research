<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap');

body { font-family: 'Prompt', sans-serif; }

@keyframes gradient {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
.gradient-bg {
  background: linear-gradient(-45deg, #EEB1C6, #F5C6D6, #FFD4E5, #EEB1C6);
  background-size: 400% 400%;
  animation: gradient 15s ease infinite;
}

input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: #EEB1C6;
  box-shadow: 0 0 0 3px rgba(238,177,198,0.12);
  transform: translateY(-1px);
  transition: all 0.3s ease;
}
input.field-error, textarea.field-error, select.field-error {
  border-color: #F87171 !important;
  box-shadow: 0 0 0 3px rgba(248,113,113,0.12) !important;
}
.error-hint { font-size: 0.7rem; color: #EF4444; margin-top: 4px; display: none; }
.error-hint.show { display: block; }

.btn-hover { transition: all 0.3s ease; }
.btn-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
.btn-hover:active { transform: translateY(0); }

.card-shadow { box-shadow: 0 20px 60px rgba(238,177,198,0.3); }

@keyframes slideIn {
  from { transform: translateX(400px); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}
.toast-show { animation: slideIn 0.4s ease-out; }

label { display: block; margin-bottom: 0.4rem; color: #4A4A4A; font-weight: 500; font-size: 0.875rem; }
input, textarea, select { transition: all 0.3s ease; border: 2px solid #E5E5E5; background: #fff; font-family: 'Prompt', sans-serif; }
input::placeholder, textarea::placeholder { color: #BDBDBD; }

.section-divider { background: linear-gradient(90deg, transparent, #EEB1C6, transparent); height: 2px; margin: 1rem 0; opacity: 0.3; }

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50%       { transform: translateY(-5px); }
}
.icon-bounce:hover { animation: bounce 0.6s ease infinite; }

.section-pill {
  display: inline-flex; align-items: center; gap: 7px;
  background: rgba(238,177,198,0.18); color: #C47898;
  font-size: 0.78rem; font-weight: 600; padding: 5px 12px;
  border-radius: 999px; margin-bottom: 1rem; letter-spacing: 0.02em;
}
.hint { font-size: 0.7rem; color: #BDBDBD; margin-top: 4px; }

/* ‚îÄ‚îÄ Draft banner ‚îÄ‚îÄ */
.draft-banner {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 16px; border-radius: 12px;
  background: rgba(238,177,198,0.12);
  border: 1.5px solid rgba(238,177,198,0.35);
  color: #C47898; font-size: 0.8rem; font-weight: 500;
  margin-bottom: 1rem;
}
.draft-banner svg { flex-shrink: 0; }

/* ‚îÄ‚îÄ Occupation multi-select ‚îÄ‚îÄ */
.occ-dropdown { position: relative; }
.occ-trigger {
  width: 100%; padding: 0.75rem; border-radius: 0.75rem;
  border: 2px solid #E5E5E5; background: #fff;
  font-family: 'Prompt', sans-serif; font-size: 0.875rem; color: #4A4A4A;
  cursor: pointer; display: flex; align-items: center; justify-content: space-between;
  gap: 8px; transition: all 0.3s ease; text-align: left; user-select: none;
}
.occ-trigger:hover, .occ-trigger.open { border-color: #EEB1C6; box-shadow: 0 0 0 3px rgba(238,177,198,0.12); }
.occ-trigger-label { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #BDBDBD; }
.occ-trigger-label.has-value { color: #4A4A4A; }
.occ-chevron { flex-shrink: 0; transition: transform 0.25s ease; color: #C47898; }
.occ-trigger.open .occ-chevron { transform: rotate(180deg); }
.occ-panel {
  display: none; position: absolute; top: calc(100% + 6px); left: 0; right: 0;
  background: #fff; border: 2px solid #EEB1C6; border-radius: 0.75rem;
  box-shadow: 0 12px 32px rgba(238,177,198,0.25); z-index: 50; overflow: hidden;
}
@keyframes panelOpen {
  from { opacity: 0; transform: translateY(-6px); }
  to   { opacity: 1; transform: translateY(0); }
}
.occ-panel.open { display: block; animation: panelOpen 0.2s ease; }
.occ-select-all {
  padding: 8px 14px; background: rgba(238,177,198,0.08);
  border-bottom: 1px solid #F5E8EE; display: flex; align-items: center;
  gap: 8px; cursor: pointer; font-size: 0.78rem; font-weight: 600; color: #C47898;
}
.occ-select-all:hover { background: rgba(238,177,198,0.18); }
.occ-list { max-height: 220px; overflow-y: auto; }
.occ-list::-webkit-scrollbar { width: 4px; }
.occ-list::-webkit-scrollbar-thumb { background: #EEB1C6; border-radius: 4px; }
.occ-item {
  display: flex; align-items: center; gap: 10px; padding: 9px 14px;
  cursor: pointer; font-size: 0.83rem; color: #4A4A4A;
  border-bottom: 1px solid #FDF0F4; transition: background 0.15s;
}
.occ-item:last-child { border-bottom: none; }
.occ-item:hover { background: rgba(238,177,198,0.08); }
.occ-item.checked { background: rgba(238,177,198,0.12); color: #C47898; font-weight: 500; }
.occ-check {
  width: 16px; height: 16px; border: 2px solid #DDD; border-radius: 4px;
  flex-shrink: 0; display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; background: #fff;
}
.occ-item.checked .occ-check { background: #EEB1C6; border-color: #EEB1C6; }
.occ-item.checked .occ-check::after {
  content: ''; width: 4px; height: 7px; border: 2px solid #fff;
  border-top: none; border-left: none; transform: rotate(45deg) translateY(-1px);
}
.occ-tags { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px; }
.occ-tag {
  display: inline-flex; align-items: center; gap: 4px;
  background: rgba(238,177,198,0.2); color: #C47898;
  font-size: 0.72rem; font-weight: 600; padding: 3px 9px 3px 10px;
  border-radius: 999px; border: 1px solid rgba(238,177,198,0.4);
}
@keyframes tagPop {
  from { opacity:0; transform: scale(0.8); }
  to   { opacity:1; transform: scale(1); }
}
.occ-tag { animation: tagPop 0.2s ease; }
.occ-tag-remove { cursor: pointer; display: flex; align-items: center; opacity: 0.6; font-size: 0.9rem; line-height: 1; }
.occ-tag-remove:hover { opacity: 1; }

.btn-my-projects { background: linear-gradient(135deg, #5BA4A4 0%, #3D8080 100%); }

/* ‚îÄ‚îÄ Success Modal ‚îÄ‚îÄ */
#successModal {
  position: fixed; inset: 0; z-index: 999;
  display: flex; align-items: center; justify-content: center;
  background: rgba(0,0,0,0.35); backdrop-filter: blur(6px);
  opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
}
#successModal.show { opacity: 1; pointer-events: all; }
.modal-box {
  background: #fff; border-radius: 24px; padding: 44px 40px 36px;
  max-width: 420px; width: 90%; text-align: center;
  box-shadow: 0 32px 80px rgba(238,177,198,0.35), 0 8px 32px rgba(0,0,0,0.1);
  transform: scale(0.88) translateY(20px);
  transition: transform 0.35s cubic-bezier(.22,.68,0,1.2);
  position: relative; overflow: hidden;
}
#successModal.show .modal-box { transform: scale(1) translateY(0); }
.modal-box::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px;
  background: linear-gradient(90deg, #EEB1C6, #e68fb0, #EEB1C6);
}
.modal-icon {
  width: 72px; height: 72px; border-radius: 50%;
  background: linear-gradient(135deg, rgba(238,177,198,0.2), rgba(238,177,198,0.1));
  border: 2px solid rgba(238,177,198,0.4);
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 20px;
  animation: popIn 0.5s 0.2s cubic-bezier(.22,.68,0,1.4) both;
}
@keyframes popIn {
  from { transform: scale(0); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}
.modal-icon svg { width: 34px; height: 34px; stroke: #EEB1C6; stroke-width: 2; fill: none; }
.modal-title { font-size: 1.35rem; font-weight: 700; color: #1a1a1a; margin-bottom: 10px; }
.modal-sub { font-size: 0.875rem; color: #888; line-height: 1.65; margin-bottom: 28px; }
.modal-sub strong { color: #C47898; }
.modal-btn {
  width: 100%; padding: 14px; border-radius: 14px;
  background: linear-gradient(135deg, #EEB1C6 0%, #E89BB0 100%);
  color: #fff; border: none; font-family: 'Prompt', sans-serif;
  font-size: 0.95rem; font-weight: 600; cursor: pointer;
  box-shadow: 0 6px 20px rgba(238,177,198,0.45); transition: all 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 8px;
}
.modal-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(238,177,198,0.55); }
.modal-dots { display: flex; justify-content: center; gap: 5px; margin-top: 16px; }
.modal-dots span { width: 5px; height: 5px; border-radius: 50%; background: rgba(238,177,198,0.3); }
.modal-dots span:nth-child(2) { background: #EEB1C6; width: 14px; border-radius: 3px; }
</style>
</head>

<body class="min-h-screen flex items-center justify-center gradient-bg py-8">

<!-- SUCCESS MODAL -->
<div id="successModal">
  <div class="modal-box">
    <div class="modal-icon">
      <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
        <polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
    </div>
    <div class="modal-title">üéâ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
    <div class="modal-sub">
      ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß<br>
      ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠ <strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</strong><br>
      ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
    </div>
    <button class="modal-btn" onclick="goToSurvey()">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      ‡∏ï‡∏Å‡∏•‡∏á ‚Äî ‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
    </button>
    <div class="modal-dots"><span></span><span></span><span></span></div>
  </div>
</div>

<div class="w-[1200px] rounded-3xl p-10 card-shadow" style="background:#FFFFFF;">

<!-- TOP BAR -->
<div class="flex justify-between items-start mb-6">
  <div>
    <h1 class="text-3xl font-bold mb-1" style="color:#EEB1C6;">
      {% if draft %}‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á{% else %}‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢{% endif %}
    </h1>
    <p class="text-gray-400 text-sm">
      {% if draft %}‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢{% else %}‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û{% endif %}
    </p>
  </div>
  <div class="flex gap-3">
    <button onclick="goHome()" class="flex items-center gap-2 px-4 h-11 rounded-xl bg-white border-2 border-gray-200 text-gray-600 text-sm font-medium hover:bg-gray-50 btn-hover">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
      ‡∏Å‡∏•‡∏±‡∏ö
    </button>
    <button onclick="goSettings()" class="flex items-center gap-2 px-4 h-11 rounded-xl bg-white border-2 border-gray-200 text-gray-600 text-sm font-medium hover:bg-gray-50 btn-hover">
      <i data-lucide="settings" class="w-4 h-4"></i>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
    </button>
  </div>
</div>

{% if draft %}
<div class="draft-banner">
  <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none"
       stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
    <polyline points="14 2 14 8 20 8"/>
  </svg>
  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á: <strong style="margin-left:4px;">{{ draft.title }}</strong>
  <span style="margin-left:auto;font-size:0.72rem;color:#BDBDBD;">
    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î {{ draft.updated_at|date:"d M Y, H:i" }}
  </span>
</div>
{% endif %}

<div class="section-divider"></div>

<form id="projectForm" class="grid grid-cols-3 gap-6 mt-2" novalidate>

  {# hidden: ‡∏™‡πà‡∏á draft_id ‡∏Å‡∏•‡∏±‡∏ö API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï draft ‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà #}
  {% if draft %}
  <input type="hidden" id="draft_id" value="{{ draft.id }}">
  {% endif %}

  <!-- LEFT COL -->
  <div class="col-span-2 flex flex-col gap-5">

    <!-- 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ -->
    <div class="p-6 rounded-2xl" style="background:linear-gradient(135deg,#F8EDEC 0%,#FFF5F3 100%);">
      <div class="section-pill">
        <i data-lucide="file-text" style="width:13px;height:13px;"></i>
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
      </div>
      <div class="mb-4">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ <span style="color:#EEB1C6;">*</span></label>
        <input id="title" class="w-full p-3 rounded-xl border-2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...">
        <p class="error-hint" id="err-title">‚ö† ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
      </div>
      <div class="mb-4">
        <label>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå <span style="color:#EEB1C6;">*</span></label>
        <textarea id="objective" class="w-full p-3 rounded-xl border-2" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢..."></textarea>
        <p class="error-hint" id="err-objective">‚ö† ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</p>
      </div>
      <div>
        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
        <textarea id="description" class="w-full p-3 rounded-xl border-2" rows="4" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."></textarea>
      </div>
    </div>

    <!-- 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ -->
    <div class="p-6 rounded-2xl" style="background:linear-gradient(135deg,#F8EDEC 0%,#FFF5F3 100%);">
      <div class="section-pill">
        <i data-lucide="building-2" style="width:13px;height:13px;"></i>
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ / ‡∏ú‡∏π‡πâ‡∏à‡πâ‡∏≤‡∏á
      </div>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span style="color:#EEB1C6;">*</span></label>
          <input id="org_name" class="w-full p-3 rounded-xl border-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà">
          <p class="error-hint" id="err-org_name">‚ö† ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</p>
        </div>
        <div>
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</label>
          <select id="org_type" class="w-full p-3 rounded-xl border-2">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
            <option value="university">‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="hospital">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</option>
            <option value="government">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
            <option value="private">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô</option>
            <option value="ngo">NGO / ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏ß‡∏á‡∏´‡∏≤‡∏Å‡∏≥‡πÑ‡∏£</option>
            <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>
      </div>
      <div>
        <label>‡∏Ñ‡∏ì‡∏∞ / ‡∏ù‡πà‡∏≤‡∏¢ / ‡πÅ‡∏ú‡∏ô‡∏Å</label>
        <input id="org_dept" class="w-full p-3 rounded-xl border-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û">
        <p class="hint">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
      </div>
    </div>

    <!-- 3: ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ -->
    <div class="p-6 rounded-2xl" style="background:linear-gradient(135deg,#F8EDEC 0%,#FFF5F3 100%);">
      <div class="section-pill">
        <i data-lucide="calendar" style="width:13px;height:13px;"></i>
        ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <span style="color:#EEB1C6;">*</span></label>
          <input id="start_date" type="date" class="w-full p-3 rounded-xl border-2">
          <p class="error-hint" id="err-start_date">‚ö† ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
          <p class="hint">‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì progress bar ‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
        </div>
        <div>
          <label>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡∏ï <span style="color:#EEB1C6;">*</span></label>
          <input id="deadline" type="date" class="w-full p-3 rounded-xl border-2">
          <p class="error-hint" id="err-deadline">‚ö† ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡∏ï</p>
          <p class="hint">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô countdown ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
        </div>
      </div>
    </div>

  </div>

  <!-- RIGHT COL -->
  <div class="flex flex-col gap-5">

    <!-- 4: ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á -->
    <div class="p-6 rounded-2xl flex flex-col gap-4" style="background:linear-gradient(135deg,#F8EDEC 0%,#FFF5F3 100%);">
      <div class="section-pill">
        <i data-lucide="users" style="width:13px;height:13px;"></i>
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
      </div>
      <div>
        <label>‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</label>
        <input id="age_range" class="w-full p-3 rounded-xl border-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô 18-35">
      </div>
      <div>
        <label>‡πÄ‡∏û‡∏®</label>
        <select id="gender" class="w-full p-3 rounded-xl border-2">
          <option value="all">‡∏ó‡∏∏‡∏Å‡πÄ‡∏û‡∏®</option>
          <option value="male">‡∏ä‡∏≤‡∏¢</option>
          <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
        </select>
      </div>
      <div>
        <label>
          ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û
          <span class="hint" style="display:inline;margin-left:6px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</span>
        </label>
        <div class="occ-dropdown" id="occDropdown">
          <button type="button" class="occ-trigger" id="occTrigger" onclick="toggleOccPanel()">
            <span class="occ-trigger-label" id="occTriggerLabel">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û)</span>
            <svg class="occ-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
          <div class="occ-panel" id="occPanel">
            <div class="occ-select-all" id="selectAllRow" onclick="toggleSelectAll()">
              <div class="occ-check" id="selectAllCheck"></div>
              <span>‡∏ó‡∏∏‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</span>
            </div>
            <div class="occ-list" id="occList"></div>
          </div>
        </div>
        <div class="occ-tags" id="occTags"></div>
        <p class="hint">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏û‡∏∑‡πà‡∏≠ filter ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
      </div>
      <div>
        <label>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</label>
        <input id="location" class="w-full p-3 rounded-xl border-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø, ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà">
      </div>
      <div>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</label>
        <input id="sample_size" type="number" class="w-full p-3 rounded-xl border-2" placeholder="100">
      </div>
    </div>

    <!-- 5: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏° -->
    <div class="p-6 rounded-2xl flex flex-col gap-4" style="background:linear-gradient(135deg,#F8EDEC 0%,#FFF5F3 100%);">
      <div class="section-pill">
        <i data-lucide="list-checks" style="width:13px;height:13px;"></i>
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
      </div>
      <div>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
        <input id="question_count" type="number" class="w-full p-3 rounded-xl border-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12">
      </div>
      <div>
        <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
        <input id="est_minutes" type="number" class="w-full p-3 rounded-xl border-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10">
        <p class="hint">‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô stat pill ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</p>
      </div>
    </div>

    <div class="section-divider"></div>

    <button type="button" onclick="saveDraft()"
            class="p-4 rounded-xl bg-white border-2 border-gray-300 font-semibold text-gray-600 hover:bg-gray-50 btn-hover icon-bounce flex items-center justify-center gap-2">
      <i data-lucide="save" style="width:17px;height:17px;"></i>
      {% if draft %}‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á{% else %}‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á{% endif %}
    </button>

    <button type="submit"
            class="p-4 rounded-xl font-semibold text-white btn-hover flex items-center justify-center gap-2"
            style="background:linear-gradient(135deg,#EEB1C6 0%,#E89BB0 100%);">
      <i data-lucide="check-circle" style="width:17px;height:17px;"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
    </button>

    <button type="button" onclick="goMyProjects()"
            class="p-4 rounded-xl text-white font-semibold btn-hover flex items-center justify-center gap-2 btn-my-projects">
      <i data-lucide="folder-kanban" style="width:17px;height:17px;"></i> ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
    </button>

    <button type="button" onclick="goDraftHistory()"
            class="p-4 rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold btn-hover flex items-center justify-center gap-2">
      <i data-lucide="folder-open" style="width:17px;height:17px;"></i> ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ã‡∏ü
    </button>

  </div>
</form>

</div>

<!-- TOAST -->
<div id="toast" class="fixed top-8 right-8 hidden text-white px-8 py-4 rounded-2xl shadow-2xl font-semibold z-50"
     style="background:linear-gradient(135deg,#2C2C2C 0%,#1A1A1A 100%);"></div>

<script>
lucide.createIcons();

/* ‚ïê‚ïê OCCUPATION MULTI-SELECT ‚ïê‚ïê */
const OCC_OPTIONS = [
  { value: "Government",       label: "‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ / ‡∏£‡∏±‡∏ê‡∏ß‡∏¥‡∏™‡∏≤‡∏´‡∏Å‡∏¥‡∏à" },
  { value: "Private Employee", label: "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô" },
  { value: "Business Owner",   label: "‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£" },
  { value: "Freelance",        label: "‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå" },
  { value: "Agriculture",      label: "‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£" },
  { value: "Labor",            label: "‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô" },
  { value: "Professional",     label: "‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û (‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏ó‡∏ô‡∏≤‡∏¢ ‡∏Ø‡∏•‡∏Ø)" },
  { value: "Student",          label: "‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤" },
  { value: "Unemployed",       label: "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô" },
  { value: "Other",            label: "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" },
];

let selectedOcc = new Set();
const occList = document.getElementById("occList");

OCC_OPTIONS.forEach(opt => {
  const item = document.createElement("div");
  item.className = "occ-item";
  item.dataset.value = opt.value;
  item.innerHTML = `<div class="occ-check"></div><span>${opt.label}</span>`;
  item.addEventListener("click", () => toggleOcc(opt.value, opt.label, item));
  occList.appendChild(item);
});

function toggleOcc(value, label, el) {
  if (selectedOcc.has(value)) { selectedOcc.delete(value); el.classList.remove("checked"); }
  else { selectedOcc.add(value); el.classList.add("checked"); }
  updateSelectAll(); renderTags(); updateTriggerLabel();
}
function toggleSelectAll() {
  const all = selectedOcc.size === OCC_OPTIONS.length;
  if (all) {
    selectedOcc.clear();
    document.querySelectorAll(".occ-item").forEach(el => el.classList.remove("checked"));
  } else {
    OCC_OPTIONS.forEach(o => selectedOcc.add(o.value));
    document.querySelectorAll(".occ-item").forEach(el => el.classList.add("checked"));
  }
  updateSelectAll(); renderTags(); updateTriggerLabel();
}
function updateSelectAll() {
  const check = document.getElementById("selectAllCheck");
  const all = selectedOcc.size === OCC_OPTIONS.length;
  const none = selectedOcc.size === 0;
  check.style.background  = all ? "#EEB1C6" : none ? "#fff" : "rgba(238,177,198,0.4)";
  check.style.borderColor = (all || !none) ? "#EEB1C6" : "#DDD";
  check.innerHTML = all
    ? `<span style="display:block;width:4px;height:7px;border:2px solid #fff;border-top:none;border-left:none;transform:rotate(45deg) translateY(-1px);"></span>`
    : none ? "" : `<span style="display:block;width:8px;height:2px;background:#fff;border-radius:2px;"></span>`;
}
function renderTags() {
  const container = document.getElementById("occTags");
  container.innerHTML = "";
  selectedOcc.forEach(val => {
    const opt = OCC_OPTIONS.find(o => o.value === val);
    if (!opt) return;
    const tag = document.createElement("span");
    tag.className = "occ-tag";
    tag.innerHTML = `${opt.label}<span class="occ-tag-remove" onclick="removeOcc('${val}')">√ó</span>`;
    container.appendChild(tag);
  });
}
function removeOcc(value) {
  selectedOcc.delete(value);
  const el = occList.querySelector(`[data-value="${value}"]`);
  if (el) el.classList.remove("checked");
  updateSelectAll(); renderTags(); updateTriggerLabel();
}
function updateTriggerLabel() {
  const lbl = document.getElementById("occTriggerLabel");
  if (selectedOcc.size === 0) {
    lbl.textContent = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û)";
    lbl.classList.remove("has-value");
  } else if (selectedOcc.size === OCC_OPTIONS.length) {
    lbl.textContent = "‡∏ó‡∏∏‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û";
    lbl.classList.add("has-value");
  } else {
    lbl.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${selectedOcc.size} ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û`;
    lbl.classList.add("has-value");
  }
}
function toggleOccPanel() {
  const panel = document.getElementById("occPanel");
  const trigger = document.getElementById("occTrigger");
  const isOpen = panel.classList.toggle("open");
  trigger.classList.toggle("open", isOpen);
}
document.addEventListener("click", e => {
  if (!document.getElementById("occDropdown").contains(e.target)) {
    document.getElementById("occPanel").classList.remove("open");
    document.getElementById("occTrigger").classList.remove("open");
  }
});

/* ‚ïê‚ïê VALIDATION ‚ïê‚ïê */
const REQUIRED_FIELDS = [
  { id: "title",      errId: "err-title" },
  { id: "objective",  errId: "err-objective" },
  { id: "org_name",   errId: "err-org_name" },
  { id: "start_date", errId: "err-start_date" },
  { id: "deadline",   errId: "err-deadline" },
];
function validateForm() {
  let valid = true;
  REQUIRED_FIELDS.forEach(({ id, errId }) => {
    const el = document.getElementById(id);
    const err = document.getElementById(errId);
    if (!el.value.trim()) {
      el.classList.add("field-error"); err.classList.add("show"); valid = false;
    } else {
      el.classList.remove("field-error"); err.classList.remove("show");
    }
  });
  const sd = document.getElementById("start_date").value;
  const dl = document.getElementById("deadline").value;
  if (sd && dl && dl < sd) {
    const errDl = document.getElementById("err-deadline");
    document.getElementById("deadline").classList.add("field-error");
    errDl.textContent = "‚ö† ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡∏ï‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô";
    errDl.classList.add("show");
    valid = false;
  }
  if (!valid) {
    const firstErr = document.querySelector(".field-error");
    if (firstErr) firstErr.scrollIntoView({ behavior: "smooth", block: "center" });
  }
  return valid;
}
REQUIRED_FIELDS.forEach(({ id, errId }) => {
  document.getElementById(id).addEventListener("input", e => {
    if (e.target.value.trim()) {
      e.target.classList.remove("field-error");
      document.getElementById(errId).classList.remove("show");
    }
  });
});

/* ‚ïê‚ïê MODAL & TOAST ‚ïê‚ïê */
function showSuccessModal() { document.getElementById("successModal").classList.add("show"); }
function goToSurvey()       { window.location.href = "/survey/create-survey/"; }
function showToast(msg) {
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.classList.remove("hidden");
  t.classList.add("toast-show");
  setTimeout(() => { t.classList.add("hidden"); t.classList.remove("toast-show"); }, 2500);
}
function resetOcc() {
  selectedOcc.clear();
  document.querySelectorAll(".occ-item").forEach(el => el.classList.remove("checked"));
  renderTags(); updateTriggerLabel(); updateSelectAll();
}

/* ‚ïê‚ïê GATHER DATA ‚ïê‚ïê */
function getData(status) {
  return {
    title:          document.getElementById("title").value,
    objective:      document.getElementById("objective").value,
    description:    document.getElementById("description").value,
    org_name:       document.getElementById("org_name").value,
    org_type:       document.getElementById("org_type").value,
    org_dept:       document.getElementById("org_dept").value,
    start_date:     document.getElementById("start_date").value,
    deadline:       document.getElementById("deadline").value,
    age_range:      document.getElementById("age_range").value,
    gender:         document.getElementById("gender").value,
    occupations:    selectedOcc.size === 0 ? ["all"] : [...selectedOcc],
    location:       document.getElementById("location").value,
    sample_size:    document.getElementById("sample_size").value,
    question_count: document.getElementById("question_count").value,
    est_minutes:    document.getElementById("est_minutes").value,
    draft_id:       document.getElementById("draft_id")?.value || null,
    status,
  };
}

async function send(status) {
  const res = await fetch("/hire/create-project-api/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(getData(status)),
  });
  return await res.json();
}

/* ‚ïê‚ïê SUBMIT ‚ïê‚ïê */
document.getElementById("projectForm").addEventListener("submit", async e => {
  e.preventDefault();
  if (!validateForm()) return;
  try {
    const r = await send("active");
    if (r.status === "success") {
      document.getElementById("projectForm").reset();
      resetOcc();
      showSuccessModal();
    } else {
      showToast("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + (r.message || "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"));
    }
  } catch { showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ server ‡πÑ‡∏î‡πâ"); }
});

/* ‚ïê‚ïê SAVE DRAFT ‚ïê‚ïê */
async function saveDraft() {
  try {
    const r = await send("draft");
    if (r.status === "success") {
      showToast("üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß");
      if (!document.getElementById("draft_id")) {
        setTimeout(() => { window.location.href = "/hire/drafts/"; }, 1200);
      }
    } else {
      showToast("‚ùå ‡πÄ‡∏ã‡∏ü‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (r.message || ""));
    }
  } catch { showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ server ‡πÑ‡∏î‡πâ"); }
}

/* ‚ïê‚ïê NAV ‚ïê‚ïê */
function goMyProjects()   { window.location.href = "/hire/my-projects/"; }
function goDraftHistory() { window.location.href = "/hire/drafts/"; }
function goHome()         { window.location.href = "/home/home-page/"; }
function goSettings()     { window.location.href = "/settings/"; }

/* ‚ïê‚ïê ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ DRAFT ‡πÄ‡∏Ç‡πâ‡∏≤ FORM ‚ïê‚ïê */
(function loadDraft() {
  const el = document.getElementById("draft-data");
  if (!el) return;                          // ‡πÑ‡∏°‡πà‡∏°‡∏µ draft ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°
  const d = JSON.parse(el.textContent);

  ["title","objective","description","org_name","org_dept",
   "start_date","deadline","age_range","location",
   "sample_size","question_count","est_minutes"].forEach(id => {
    const field = document.getElementById(id);
    if (field && d[id] !== "" && d[id] !== null) field.value = d[id];
  });

  if (d.org_type) document.getElementById("org_type").value = d.org_type;
  if (d.gender)   document.getElementById("gender").value   = d.gender;

  if (Array.isArray(d.occupations) && d.occupations.length && d.occupations[0] !== "all") {
    d.occupations.forEach(val => {
      selectedOcc.add(val);
      const item = occList.querySelector(`[data-value="${val}"]`);
      if (item) item.classList.add("checked");
    });
    updateSelectAll();
    renderTags();
    updateTriggerLabel();
  }
})();
</script>

{% if draft %}
<script id="draft-data" type="application/json">
{
  "title":          "{{ draft.title|escapejs }}",
  "objective":      "{{ draft.objective|default:''|escapejs }}",
  "description":    "{{ draft.description|default:''|escapejs }}",
  "org_name":       "{{ draft.org_name|default:''|escapejs }}",
  "org_type":       "{{ draft.org_type|default:''|escapejs }}",
  "org_dept":       "{{ draft.org_dept|default:''|escapejs }}",
  "start_date":     "{{ draft.start_date|default:''|escapejs }}",
  "deadline":       "{{ draft.deadline|default:''|escapejs }}",
  "age_range":      "{{ draft.age_range|default:''|escapejs }}",
  "gender":         "{{ draft.gender|default:'all'|escapejs }}",
  "location":       "{{ draft.location|default:''|escapejs }}",
  "sample_size":    "{{ draft.sample_size|default:''|escapejs }}",
  "question_count": "{{ draft.question_count|default:''|escapejs }}",
  "est_minutes":    "{{ draft.est_minutes|default:''|escapejs }}",
  "occupations":    {{ draft.occupations|default:"[]"|safe }}
}
</script>
{% endif %}

</body>
</html>
